<div class="card flex justify-content-center">
  <p-toast />
  <p-accordion
    class="w-full"
    expandIcon="pi pi-plus"
    collapseIcon="pi pi-minus"
  >
    <p-accordionTab *ngFor="let order of orders; let i = index">
      <ng-template pTemplate="header">
        <span
          class="flex justify-content-between align-items-center gap-2 w-full"
        >
          <span class="font-bold white-space-nowrap">Sipariş {{ i + 1 }}</span>
          <p-tag
            [value]="'Üretici Adı: ' + order.user"
            severity="warning"
            class="font-bold mr-auto ml-2"
          ></p-tag>
          <span class="font-bold white-space-nowrap ml-auto mr-2">
            Sipariş Tarihi: {{ order.createdAt | date : "dd/MM/yyyy" }}
          </span>
          <p-tag [value]="order.status" severity="info" class="mr-2"></p-tag>
        </span>
      </ng-template>
      <div class="flex justify-content-center">
        <div class="col-12 xl:col-10">
          <p-accordion>
            <p-accordionTab *ngFor="let brand of getBrands(order.orderDetails)">
              <ng-template pTemplate="header">
                <div
                  class="flex justify-content-between align-items-center gap-2 w-full"
                >
                  <p-image
                    [src]="
                      photoUrl +
                      order.orderDetails[brand.toUpperCase()][0].caseImage
                    "
                    [preview]="true"
                    width="32"
                    height="32"
                    class="mr-2"
                  />
                  <span class="font-bold white-space-nowrap">{{ brand }}</span>
                  <p-tag
                    [value]="getBrandStatus(order.orderDetails[brand])"
                    severity="success"
                    class="ml-auto"
                  ></p-tag>
                </div>
              </ng-template>
              <p-table
                #dt1
                [value]="order.orderDetails[brand]"
                styleClass="p-datatable-striped"
                [tableStyle]="{ 'min-width': '50rem' }"
                [globalFilterFields]="[
                  'caseModel',
                  'phoneName',
                  'label',
                  'stockCode',
                  'barcode',
                  'quantity',
                  'status'
                ]"
                [paginator]="true"
                [rows]="10"
                [rowsPerPageOptions]="[10, 20, 30]"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
              >
                <ng-template pTemplate="caption">
                  <div class="flex justify-content-end flex-column sm:flex-row">
                    <span class="p-input-icon-left mr-2">
                      <i class="pi pi-search"></i>
                      <input
                        pInputText
                        type="text"
                        #filter
                        (input)="onGlobalFilter(dt1, $event)"
                        placeholder="Ara"
                        class="w-full"
                      />
                    </span>
                    <button
                      pButton
                      label="Temizle"
                      class="p-button-outlined mr-auto"
                      icon="pi pi-filter-slash"
                      (click)="clear(dt1)"
                    ></button>
                    <p-dropdown
                      [options]="statuses"
                      [(ngModel)]="order.orderDetails[brand][0].status"
                      optionLabel="label"
                      optionValue="id"
                      placeholder="Select a Status"
                      (onChange)="
                        onStatusChange(
                          order,
                          order.orderDetails[brand],
                          $event.value
                        )
                      "
                    ></p-dropdown>
                    <span class="p-input-icon-left ml-2">
                      <i class="pi pi-upload"></i>
                      <input
                        pInputText
                        type="file"
                        #filter
                        placeholder="Browse File"
                        class="w-full"
                        (change)="onFileSelected($event)"
                      />
                    </span>
                    <button
                      pButton
                      label="Upload"
                      class="p-button-outlined ml-2"
                      icon="pi pi-upload"
                      (click)="uploadFile(order.id)"
                    ></button>
                    <button
                      pButton
                      label="Export"
                      class="p-button-outlined ml-2"
                      icon="pi pi-upload"
                      severity="success"
                      (click)="downloadOrder(order.id, brand)"
                    ></button>
                  </div>
                </ng-template>
                <ng-template pTemplate="header">
                  <tr>
                    <th>Kılıf Resmi</th>
                    <th>Kılıf Markası</th>
                    <th>Kılıf Modeli</th>
                    <th>Telefon Modeli</th>
                    <th>Etiket</th>
                    <th>Stok Kodu</th>
                    <th>Barkod</th>
                    <th>Adet</th>
                    <th>Durum</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-orderDetail>
                  <tr>
                    <td>
                      <p-image
                        [src]="photoUrl + orderDetail.caseImage"
                        width="50"
                        [preview]="true"
                        [alt]="orderDetail.brandName"
                        loading="lazy"
                      ></p-image>
                    </td>
                    <td>{{ orderDetail.brandName }}</td>
                    <td>{{ orderDetail.caseModel }}</td>
                    <td>{{ orderDetail.phoneName }}</td>
                    <td>{{ orderDetail.label }}</td>
                    <td>{{ orderDetail.stockCode.replace("//", "/") }}</td>
                    <td>{{ orderDetail.barcode }}</td>
                    <td>{{ orderDetail.quantity }}</td>
                    <td>
                      <p-tag
                        [value]="orderDetail.status"
                        [severity]="getSeverity(orderDetail.status)"
                      ></p-tag>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </p-accordionTab>
          </p-accordion>
        </div>
        <div class="col-12 xl:col-2">
          <ul>
            <li *ngFor="let file of order.orderFiles" class="flex justify-content-center">
              <button
                pButton
                icon="pi pi-times"
                [rounded]="true"
                [text]="true"
                severity="danger"
                (click)="deleteFile(file.id)"
              ></button>
              <a [href]="photoUrl + file.fileUrl" target="_blank">{{ file.fileName }}</a>
            </li>
          </ul>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>
</div>
